async function getScripts(){return new Promise(t=>{chrome.storage.local.get("scripts",e=>{t(e.scripts||[])})})}async function saveScript(t){t.id||(t.id=Date.now().toString(36)+Math.random().toString(36).substr(2,5)),t.addedAt=Date.now();let r=await getScripts(),e=r.findIndex(e=>e.metadata.name===t.metadata.name&&e.metadata.namespace===t.metadata.namespace);return 0<=e?r[e]=t:r.push(t),new Promise(e=>{chrome.storage.local.set({scripts:r},e)})}async function removeScript(t){let r=(await getScripts()).filter(e=>e.id!==t);return new Promise(e=>{chrome.storage.local.set({scripts:r},e)})}async function secureStorageOperation(e){var t;if(chrome.runtime.id)return t=await crypto.subtle.importKey("raw",(new TextEncoder).encode("zed-secret-key"),{name:"AES-GCM"},!1,["encrypt","decrypt"]),crypto.subtle[e](t,...arguments);throw new Error("Operaci√≥n no permitida")}export{getScripts,saveScript,removeScript};