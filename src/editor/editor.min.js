let urlParams=new URLSearchParams(window.location.search),scriptId=urlParams.get("id"),scriptName=urlParams.get("name")||"New Script";function initializeEditor(){var e=document.getElementById("script-content"),t=(document.getElementById("line-numbers"),document.getElementById("save-script").addEventListener("click",saveScript),document.getElementById("cancel-edit").addEventListener("click",cancelEdit),document.getElementById("download-script")),t=(t&&t.addEventListener("click",downloadScript),document.getElementById("refresh-script")),t=(t&&t.addEventListener("click",refreshScript),document.getElementById("delete-script")),t=(t&&t.addEventListener("click",deleteScript),document.getElementById("log-button"));t&&t.addEventListener("click",logScriptContent),e.addEventListener("input",()=>{updateLineNumbers(),highlightSyntax(),updateCursorPosition()}),e.addEventListener("scroll",()=>{syncScroll(),highlightSyntax()}),e.addEventListener("keydown",handleTabKey),e.addEventListener("click",updateCursorPosition),e.addEventListener("keyup",updateCursorPosition),document.getElementById("search-scripts").addEventListener("input",filterScripts),loadAllScripts(),scriptId?loadScriptContent(scriptId):(e.value=getScriptTemplate(),updateLineNumbers()),urlParams.get("loadTemp")&&chrome.storage.local.get("tempScriptContent",function(e){e.tempScriptContent&&(document.getElementById("script-content").value=e.tempScriptContent,updateLineNumbers(),chrome.storage.local.remove("tempScriptContent"))})}function getScriptTemplate(){return`[script]
name = "Hello World Script"
namespace = "zedmonkey"
version = "1.0"
description = "Muestra una alerta de 'Hello World' al cargar la página"
author = "Zedmonkey User"
match = "*://*/*"
grant = "none"

(function() {
    'use strict';
    
    // Crear un elemento de notificación estilizado
    const notification = document.createElement('div');
    notification.style.cssText = \`
        position: fixed;
        top: 20px;
        right: 20px;
        background: #4CAF50;
        color: white;
        padding: 15px 20px;
        border-radius: 4px;
        font-family: Arial, sans-serif;
        z-index: 9999;
        box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        transition: opacity 0.5s ease-in-out;
    \`;
    notification.textContent = '¡Hello World desde Zedmonkey!';
    
    // Añadir la notificación al documento
    document.body.appendChild(notification);
    
    // Desvanecer y eliminar después de 3 segundos
    setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
            notification.remove();
        }, 500);
    }, 3000);
    
    // También mostrar en la consola
    console.log('Hello World desde Zedmonkey!');
})();
`}function loadAllScripts(){chrome.runtime.sendMessage({action:"getScripts"},e=>{e&&e.scripts?renderScriptsList(e.scripts):showStatusMessage("Error loading scripts",!0)})}function renderScriptsList(e){let c=document.getElementById("scripts-list");c.innerHTML="",0===e.length?c.innerHTML='<div class="empty-state">No scripts installed</div>':e.forEach(e=>{var t=document.createElement("div"),n=(t.className="script-item",e.id===scriptId&&t.classList.add("active"),getScriptType(e)),i=(t.style.borderLeftColor="css"===n?"#4caf50":"bookmarklet"===n?"#2196f3":"#ffcc00",document.createElement("div")),o=(i.className="script-info",document.createElement("div")),s=(o.style.display="flex",o.style.alignItems="center",document.createElement("span")),n=(s.className="script-badge "+n,s.textContent=n.toUpperCase(),o.appendChild(s),document.createElement("div")),s=(n.className="script-name",n.style.display="inline",n.textContent=e.metadata?.name||"Unnamed Script",o.appendChild(n),i.appendChild(o),document.createElement("div")),o=(s.className="script-meta",s.textContent=`v${e.metadata?.version||"1.0"} • `+(e.metadata?.match?.[0]||"*"),i.appendChild(s),e.metadata?.description&&((n=document.createElement("div")).className="script-description",n.textContent=e.metadata.description,i.appendChild(n)),document.createElement("label")),s=(o.className="toggle-switch",document.createElement("input")),n=(s.type="checkbox",s.checked=!1!==e.enabled,s.dataset.scriptId=e.id,s.addEventListener("change",toggleScriptEnabled),document.createElement("span"));n.className="slider",o.appendChild(s),o.appendChild(n),t.appendChild(i),t.appendChild(o),i.addEventListener("click",()=>{window.location.href=`editor.html?id=${e.id}&name=`+encodeURIComponent(e.metadata?.name||"Script")}),c.appendChild(t)})}function getScriptType(e){if(e.content){if(e.metadata?.type)return e.metadata.type.toLowerCase();if(!e.content.includes("@resource")&&!e.content.includes("@require")){if(e.content.trim().startsWith("javascript:"))return"bookmarklet";e.content.includes("@-moz-document")||e.content.includes("@namespace")||e.content.includes("@media")}}return"js"}function toggleScriptEnabled(t){var e=t.target.dataset.scriptId;let n=t.target.checked;chrome.runtime.sendMessage({action:"toggleScriptEnabled",scriptId:e,enabled:n},e=>{e&&e.success?showStatusMessage("Script "+(n?"enabled":"disabled")):(showStatusMessage("Error updating script state",!0),t.target.checked=!n)})}function filterScripts(e){let i=e.target.value.toLowerCase();document.querySelectorAll(".script-item").forEach(e=>{var t=e.querySelector(".script-name").textContent.toLowerCase(),n=e.querySelector(".script-meta").textContent.toLowerCase();t.includes(i)||n.includes(i)?e.style.display="flex":e.style.display="none"})}function loadScriptContent(e){chrome.runtime.sendMessage({action:"getScriptContent",scriptId:e},e=>{e&&e.content?(document.getElementById("script-content").value=e.content,updateLineNumbers(),showStatusMessage("Script loaded successfully")):showStatusMessage("Error loading script",!0)})}function saveScript(){var e,t=document.getElementById("script-content").value.trim();t?(e=scriptId?"updateScriptContent":"addScript",chrome.runtime.sendMessage({action:e,scriptContent:t,scriptId:scriptId},e=>{e&&e.success?(showStatusMessage("Script saved successfully"),!scriptId&&e.scriptId&&(window.location.href=`editor.html?id=${e.scriptId}&name=`+encodeURIComponent(e.name||"Script"))):showStatusMessage("Error saving script: "+(e.error||"Unknown error"),!0)})):showStatusMessage("Please enter script content",!0)}function cancelEdit(){window.close()}function logScriptContent(){console.log(document.getElementById("script-content").value),showStatusMessage("Script content logged to console")}function updateLineNumbers(){var e=document.getElementById("script-content"),t=document.getElementById("line-numbers"),n=e.value.split("\n").length;t.innerHTML="";for(let e=1;e<=Math.max(10,n);e++){var i=document.createElement("div");i.textContent=e,t.appendChild(i)}}function syncScroll(){var e=document.getElementById("script-content");document.getElementById("line-numbers").scrollTop=e.scrollTop}function handleTabKey(e){var t,n;"Tab"===e.key&&(e.preventDefault(),t=(e=e.target).selectionStart,n=e.selectionEnd,e.value=e.value.substring(0,t)+"  "+e.value.substring(n),e.selectionStart=e.selectionEnd=t+2)}function showStatusMessage(e,t=!1){let n=document.getElementById("status-message");n.textContent=e,n.style.color=t?"#f44336":"#4caf50",setTimeout(()=>{n.textContent=""},3e3)}function downloadScript(){var e=document.getElementById("script-content").value,t=document.getElementById("script-title").textContent.replace(/[^a-z0-9]/gi,"_").toLowerCase()+".js",e=new Blob([e],{type:"text/javascript"});let n=URL.createObjectURL(e),i=document.createElement("a");i.href=n,i.download=t,document.body.appendChild(i),i.click(),setTimeout(()=>{document.body.removeChild(i),URL.revokeObjectURL(n)},0),showStatusMessage("Script downloaded")}function refreshScript(){scriptId?(loadScriptContent(scriptId),showStatusMessage("Script refreshed")):showStatusMessage("Cannot refresh new script",!0)}function deleteScript(){scriptId?confirm("Are you sure you want to delete this script?")&&chrome.runtime.sendMessage({action:"removeScript",scriptId:scriptId},e=>{e&&e.success?(showStatusMessage("Script deleted"),setTimeout(()=>{window.location.href="editor.html"},1e3)):showStatusMessage("Error deleting script",!0)}):showStatusMessage("Cannot delete new script",!0)}function loadTempContentIfNeeded(){"true"===new URLSearchParams(window.location.search).get("loadTemp")&&chrome.storage.local.get("tempScriptContent",e=>{e.tempScriptContent?(editor.setValue(e.tempScriptContent),chrome.storage.local.remove("tempScriptContent")):console.error("No temporary script content found")})}function highlightSyntax(){var e=document.getElementById("script-content"),t=document.getElementById("highlight-layer"),n=applyHighlighting(e.value);t.innerHTML=n,t.scrollTop=e.scrollTop,t.scrollLeft=e.scrollLeft}function applyHighlighting(e){return e?e.replace(/(\[script\])/g,'<span class="token zedata-section">$1</span>').replace(/^(\w+)\s*=\s*(".*?")/gm,'<span class="token zedata-key">$1</span> <span class="token operator">=</span> <span class="token zedata-value">$2</span>').replace(/(\/\/.*$)/gm,'<span class="token comment">$1</span>').replace(/(\/\*[\s\S]*?\*\/)/g,'<span class="token comment">$1</span>').replace(/("(?:\\.|[^"\\])*")|('(?:\\.|[^'\\])*')|(`(?:\\.|[^`\\])*`)/g,'<span class="token string">$1$2$3</span>').replace(/\b(\d+(?:\.\d+)?)\b/g,'<span class="token number">$1</span>').replace(/\b(const|let|var|function|return|if|else|for|while|do|switch|case|break|continue|new|try|catch|finally|throw|class|extends|import|export|default|from|async|await|this|super|yield|typeof|instanceof|in|of|delete|void|null|undefined|true|false)\b/g,'<span class="token keyword">$1</span>').replace(/\b([a-zA-Z_$][a-zA-Z0-9_$]*)\s*\(/g,'<span class="token function">$1</span>(').replace(/([{}[\]()])/g,'<span class="token bracket">$1</span>').replace(/(\+|\-|\*|\/|%|=|\+=|\-=|\*=|\/=|%=|==|===|!=|!==|>|<|>=|<=|&&|\|\||!|\?|:|&|\||\^|~|<<|>>|>>>)/g,'<span class="token operator">$1</span>').replace(/([;,.])/g,'<span class="token punctuation">$1</span>'):""}function updateCursorPosition(){var e=document.getElementById("script-content"),t=document.getElementById("cursor-position"),n=e.value,i=e.selectionStart;let o=1,s=1;for(let e=0;e<i;e++)"\n"===n[e]?(o++,s=1):s++;t.textContent=`Line: ${o}, Column: `+s,highlightCurrentLine(o)}function highlightCurrentLine(e){var t=document.getElementById("highlight-layer"),n=t.innerHTML.split("\n");for(let e=0;e<n.length;e++)n[e]=n[e].replace(/<div class="current-line">(.*?)<\/div>/g,"$1");0<e&&e<=n.length&&(n[e-1]=`<div class="current-line">${n[e-1]}</div>`),t.innerHTML=n.join("\n")}function initializeEditor(){scriptContent.addEventListener("input",()=>{updateLineNumbers(),highlightSyntax(),updateCursorPosition()}),scriptContent.addEventListener("scroll",()=>{syncScroll(),highlightSyntax()}),scriptContent.addEventListener("keydown",handleTabKey),scriptContent.addEventListener("click",updateCursorPosition),scriptContent.addEventListener("keyup",updateCursorPosition),document.getElementById("search-scripts").addEventListener("input",filterScripts),loadAllScripts(),scriptId?loadScriptContent(scriptId):(scriptContent.value=getScriptTemplate(),updateLineNumbers()),urlParams.get("loadTemp")&&chrome.storage.local.get("tempScriptContent",function(e){e.tempScriptContent&&(document.getElementById("script-content").value=e.tempScriptContent,updateLineNumbers(),chrome.storage.local.remove("tempScriptContent"))})}function getScriptTemplate(){return`[script]
name = "Hello World Script"
namespace = "zedmonkey"
version = "1.0"
description = "Muestra una alerta de 'Hello World' al cargar la página"
author = "Zedmonkey User"
match = "*://*/*"
grant = "none"

(function() {
    'use strict';
    
    // Crear un elemento de notificación estilizado
    const notification = document.createElement('div');
    notification.style.cssText = \`
        position: fixed;
        top: 20px;
        right: 20px;
        background: #4CAF50;
        color: white;
        padding: 15px 20px;
        border-radius: 4px;
        font-family: Arial, sans-serif;
        z-index: 9999;
        box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        transition: opacity 0.5s ease-in-out;
    \`;
    notification.textContent = '¡Hello World desde Zedmonkey!';
    
    // Añadir la notificación al documento
    document.body.appendChild(notification);
    
    // Desvanecer y eliminar después de 3 segundos
    setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
            notification.remove();
        }, 500);
    }, 3000);
    
    // También mostrar en la consola
    console.log('Hello World desde Zedmonkey!');
})();
`}function loadAllScripts(){chrome.runtime.sendMessage({action:"getScripts"},e=>{e&&e.scripts?renderScriptsList(e.scripts):showStatusMessage("Error loading scripts",!0)})}function renderScriptsList(e){let c=document.getElementById("scripts-list");c.innerHTML="",0===e.length?c.innerHTML='<div class="empty-state">No scripts installed</div>':e.forEach(e=>{var t=document.createElement("div"),n=(t.className="script-item",e.id===scriptId&&t.classList.add("active"),getScriptType(e)),i=(t.style.borderLeftColor="css"===n?"#4caf50":"bookmarklet"===n?"#2196f3":"#ffcc00",document.createElement("div")),o=(i.className="script-info",document.createElement("div")),s=(o.style.display="flex",o.style.alignItems="center",document.createElement("span")),n=(s.className="script-badge "+n,s.textContent=n.toUpperCase(),o.appendChild(s),document.createElement("div")),s=(n.className="script-name",n.style.display="inline",n.textContent=e.metadata?.name||"Unnamed Script",o.appendChild(n),i.appendChild(o),document.createElement("div")),o=(s.className="script-meta",s.textContent=`v${e.metadata?.version||"1.0"} • `+(e.metadata?.match?.[0]||"*"),i.appendChild(s),e.metadata?.description&&((n=document.createElement("div")).className="script-description",n.textContent=e.metadata.description,i.appendChild(n)),document.createElement("label")),s=(o.className="toggle-switch",document.createElement("input")),n=(s.type="checkbox",s.checked=!1!==e.enabled,s.dataset.scriptId=e.id,s.addEventListener("change",toggleScriptEnabled),document.createElement("span"));n.className="slider",o.appendChild(s),o.appendChild(n),t.appendChild(i),t.appendChild(o),i.addEventListener("click",()=>{window.location.href=`editor.html?id=${e.id}&name=`+encodeURIComponent(e.metadata?.name||"Script")}),c.appendChild(t)})}function getScriptType(e){if(e.content){if(e.metadata?.type)return e.metadata.type.toLowerCase();if(!e.content.includes("@resource")&&!e.content.includes("@require")){if(e.content.trim().startsWith("javascript:"))return"bookmarklet";e.content.includes("@-moz-document")||e.content.includes("@namespace")||e.content.includes("@media")}}return"js"}function toggleScriptEnabled(t){var e=t.target.dataset.scriptId;let n=t.target.checked;chrome.runtime.sendMessage({action:"toggleScriptEnabled",scriptId:e,enabled:n},e=>{e&&e.success?showStatusMessage("Script "+(n?"enabled":"disabled")):(showStatusMessage("Error updating script state",!0),t.target.checked=!n)})}function filterScripts(e){let i=e.target.value.toLowerCase();document.querySelectorAll(".script-item").forEach(e=>{var t=e.querySelector(".script-name").textContent.toLowerCase(),n=e.querySelector(".script-meta").textContent.toLowerCase();t.includes(i)||n.includes(i)?e.style.display="flex":e.style.display="none"})}function loadScriptContent(e){chrome.runtime.sendMessage({action:"getScriptContent",scriptId:e},e=>{e&&e.content?(document.getElementById("script-content").value=e.content,updateLineNumbers(),showStatusMessage("Script loaded successfully")):showStatusMessage("Error loading script",!0)})}function saveScript(){var e,t=document.getElementById("script-content").value.trim();t?(e=scriptId?"updateScriptContent":"addScript",chrome.runtime.sendMessage({action:e,scriptContent:t,scriptId:scriptId},e=>{e&&e.success?(showStatusMessage("Script saved successfully"),!scriptId&&e.scriptId&&(window.location.href=`editor.html?id=${e.scriptId}&name=`+encodeURIComponent(e.name||"Script"))):showStatusMessage("Error saving script: "+(e.error||"Unknown error"),!0)})):showStatusMessage("Please enter script content",!0)}function cancelEdit(){window.close()}function logScriptContent(){console.log(document.getElementById("script-content").value),showStatusMessage("Script content logged to console")}function updateLineNumbers(){var e=document.getElementById("script-content"),t=document.getElementById("line-numbers"),n=e.value.split("\n").length;t.innerHTML="";for(let e=1;e<=Math.max(10,n);e++){var i=document.createElement("div");i.textContent=e,t.appendChild(i)}}function syncScroll(){var e=document.getElementById("script-content");document.getElementById("line-numbers").scrollTop=e.scrollTop}function handleTabKey(e){var t,n;"Tab"===e.key&&(e.preventDefault(),t=(e=e.target).selectionStart,n=e.selectionEnd,e.value=e.value.substring(0,t)+"  "+e.value.substring(n),e.selectionStart=e.selectionEnd=t+2)}function showStatusMessage(e,t=!1){let n=document.getElementById("status-message");n.textContent=e,n.style.color=t?"#f44336":"#4caf50",setTimeout(()=>{n.textContent=""},3e3)}function downloadScript(){var e=document.getElementById("script-content").value,t=document.getElementById("script-title").textContent.replace(/[^a-z0-9]/gi,"_").toLowerCase()+".js",e=new Blob([e],{type:"text/javascript"});let n=URL.createObjectURL(e),i=document.createElement("a");i.href=n,i.download=t,document.body.appendChild(i),i.click(),setTimeout(()=>{document.body.removeChild(i),URL.revokeObjectURL(n)},0),showStatusMessage("Script downloaded")}function refreshScript(){scriptId?(loadScriptContent(scriptId),showStatusMessage("Script refreshed")):showStatusMessage("Cannot refresh new script",!0)}function deleteScript(){scriptId?confirm("Are you sure you want to delete this script?")&&chrome.runtime.sendMessage({action:"removeScript",scriptId:scriptId},e=>{e&&e.success?(showStatusMessage("Script deleted"),setTimeout(()=>{window.location.href="editor.html"},1e3)):showStatusMessage("Error deleting script",!0)}):showStatusMessage("Cannot delete new script",!0)}function loadTempContentIfNeeded(){"true"===new URLSearchParams(window.location.search).get("loadTemp")&&chrome.storage.local.get("tempScriptContent",e=>{e.tempScriptContent?(editor.setValue(e.tempScriptContent),chrome.storage.local.remove("tempScriptContent")):console.error("No temporary script content found")})}function initializeEditor(){let t=document.getElementById("script-content");document.getElementById("line-numbers");document.getElementById("save-script").addEventListener("click",saveScript),document.getElementById("cancel-edit").addEventListener("click",cancelEdit);var e=document.getElementById("download-script"),e=(e&&e.addEventListener("click",downloadScript),document.getElementById("refresh-script")),e=(e&&e.addEventListener("click",refreshScript),document.getElementById("delete-script")),e=(e&&e.addEventListener("click",deleteScript),document.getElementById("log-button"));e&&e.addEventListener("click",logScriptContent),t.addEventListener("input",()=>{updateLineNumbers(),highlightSyntax(),updateCursorPosition()}),t.addEventListener("scroll",()=>{syncScroll(),highlightSyntax()}),t.addEventListener("keydown",handleTabKey),t.addEventListener("click",updateCursorPosition),t.addEventListener("keyup",updateCursorPosition),document.getElementById("search-scripts").addEventListener("input",filterScripts),loadAllScripts(),scriptId?loadScriptContent(scriptId):(t.value=getScriptTemplate(),updateLineNumbers(),highlightSyntax()),urlParams.get("loadTemp")&&chrome.storage.local.get("tempScriptContent",function(e){e.tempScriptContent&&(t.value=e.tempScriptContent,updateLineNumbers(),highlightSyntax(),chrome.storage.local.remove("tempScriptContent"))})}function getScriptTemplate(){return`[script]
name = "Hello World Script"
namespace = "zedmonkey"
version = "1.0"
description = "Muestra una alerta de 'Hello World' al cargar la página"
author = "Zedmonkey User"
match = "*://*/*"
grant = "none"

(function() {
    'use strict';
    
    // Crear un elemento de notificación estilizado
    const notification = document.createElement('div');
    notification.style.cssText = \`
        position: fixed;
        top: 20px;
        right: 20px;
        background: #4CAF50;
        color: white;
        padding: 15px 20px;
        border-radius: 4px;
        font-family: Arial, sans-serif;
        z-index: 9999;
        box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        transition: opacity 0.5s ease-in-out;
    \`;
    notification.textContent = '¡Hello World desde Zedmonkey!';
    
    // Añadir la notificación al documento
    document.body.appendChild(notification);
    
    // Desvanecer y eliminar después de 3 segundos
    setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
            notification.remove();
        }, 500);
    }, 3000);
    
    // También mostrar en la consola
    console.log('Hello World desde Zedmonkey!');
})();
`}function loadAllScripts(){chrome.runtime.sendMessage({action:"getScripts"},e=>{e&&e.scripts?renderScriptsList(e.scripts):showStatusMessage("Error loading scripts",!0)})}function renderScriptsList(e){let c=document.getElementById("scripts-list");c.innerHTML="",0===e.length?c.innerHTML='<div class="empty-state">No scripts installed</div>':e.forEach(e=>{var t=document.createElement("div"),n=(t.className="script-item",e.id===scriptId&&t.classList.add("active"),getScriptType(e)),i=(t.style.borderLeftColor="css"===n?"#4caf50":"bookmarklet"===n?"#2196f3":"#ffcc00",document.createElement("div")),o=(i.className="script-info",document.createElement("div")),s=(o.style.display="flex",o.style.alignItems="center",document.createElement("span")),n=(s.className="script-badge "+n,s.textContent=n.toUpperCase(),o.appendChild(s),document.createElement("div")),s=(n.className="script-name",n.style.display="inline",n.textContent=e.metadata?.name||"Unnamed Script",o.appendChild(n),i.appendChild(o),document.createElement("div")),o=(s.className="script-meta",s.textContent=`v${e.metadata?.version||"1.0"} • `+(e.metadata?.match?.[0]||"*"),i.appendChild(s),e.metadata?.description&&((n=document.createElement("div")).className="script-description",n.textContent=e.metadata.description,i.appendChild(n)),document.createElement("label")),s=(o.className="toggle-switch",document.createElement("input")),n=(s.type="checkbox",s.checked=!1!==e.enabled,s.dataset.scriptId=e.id,s.addEventListener("change",toggleScriptEnabled),document.createElement("span"));n.className="slider",o.appendChild(s),o.appendChild(n),t.appendChild(i),t.appendChild(o),i.addEventListener("click",()=>{window.location.href=`editor.html?id=${e.id}&name=`+encodeURIComponent(e.metadata?.name||"Script")}),c.appendChild(t)})}function getScriptType(e){if(e.content){if(e.metadata?.type)return e.metadata.type.toLowerCase();if(!e.content.includes("@resource")&&!e.content.includes("@require")){if(e.content.trim().startsWith("javascript:"))return"bookmarklet";e.content.includes("@-moz-document")||e.content.includes("@namespace")||e.content.includes("@media")}}return"js"}function toggleScriptEnabled(t){var e=t.target.dataset.scriptId;let n=t.target.checked;chrome.runtime.sendMessage({action:"toggleScriptEnabled",scriptId:e,enabled:n},e=>{e&&e.success?showStatusMessage("Script "+(n?"enabled":"disabled")):(showStatusMessage("Error updating script state",!0),t.target.checked=!n)})}function filterScripts(e){let i=e.target.value.toLowerCase();document.querySelectorAll(".script-item").forEach(e=>{var t=e.querySelector(".script-name").textContent.toLowerCase(),n=e.querySelector(".script-meta").textContent.toLowerCase();t.includes(i)||n.includes(i)?e.style.display="flex":e.style.display="none"})}function loadScriptContent(e){chrome.runtime.sendMessage({action:"getScriptContent",scriptId:e},e=>{e&&e.content?(document.getElementById("script-content").value=e.content,updateLineNumbers(),showStatusMessage("Script loaded successfully")):showStatusMessage("Error loading script",!0)})}function saveScript(){var e,t=document.getElementById("script-content").value.trim();t?(e=scriptId?"updateScriptContent":"addScript",chrome.runtime.sendMessage({action:e,scriptContent:t,scriptId:scriptId},e=>{e&&e.success?(showStatusMessage("Script saved successfully"),!scriptId&&e.scriptId&&(window.location.href=`editor.html?id=${e.scriptId}&name=`+encodeURIComponent(e.name||"Script"))):showStatusMessage("Error saving script: "+(e.error||"Unknown error"),!0)})):showStatusMessage("Please enter script content",!0)}function cancelEdit(){window.close()}function logScriptContent(){console.log(document.getElementById("script-content").value),showStatusMessage("Script content logged to console")}function updateLineNumbers(){var e=document.getElementById("script-content"),t=document.getElementById("line-numbers"),n=e.value.split("\n").length;t.innerHTML="";for(let e=1;e<=Math.max(10,n);e++){var i=document.createElement("div");i.textContent=e,t.appendChild(i)}}function syncScroll(){var e=document.getElementById("script-content"),t=document.getElementById("line-numbers"),n=document.getElementById("highlight-layer");t.scrollTop=e.scrollTop,n&&(n.scrollTop=e.scrollTop,n.scrollLeft=e.scrollLeft)}function handleTabKey(e){var t,n;"Tab"===e.key&&(e.preventDefault(),t=(e=e.target).selectionStart,n=e.selectionEnd,e.value=e.value.substring(0,t)+"  "+e.value.substring(n),e.selectionStart=e.selectionEnd=t+2)}function showStatusMessage(e,t=!1){let n=document.getElementById("status-message");n.textContent=e,n.style.color=t?"#f44336":"#4caf50",setTimeout(()=>{n.textContent=""},3e3)}function downloadScript(){var e=document.getElementById("script-content").value,t=document.getElementById("script-title").textContent.replace(/[^a-z0-9]/gi,"_").toLowerCase()+".js",e=new Blob([e],{type:"text/javascript"});let n=URL.createObjectURL(e),i=document.createElement("a");i.href=n,i.download=t,document.body.appendChild(i),i.click(),setTimeout(()=>{document.body.removeChild(i),URL.revokeObjectURL(n)},0),showStatusMessage("Script downloaded")}function refreshScript(){scriptId?(loadScriptContent(scriptId),showStatusMessage("Script refreshed")):showStatusMessage("Cannot refresh new script",!0)}function deleteScript(){scriptId?confirm("Are you sure you want to delete this script?")&&chrome.runtime.sendMessage({action:"removeScript",scriptId:scriptId},e=>{e&&e.success?(showStatusMessage("Script deleted"),setTimeout(()=>{window.location.href="editor.html"},1e3)):showStatusMessage("Error deleting script",!0)}):showStatusMessage("Cannot delete new script",!0)}document.getElementById("script-title").textContent=scriptName,document.addEventListener("DOMContentLoaded",initializeEditor),document.addEventListener("DOMContentLoaded",()=>{loadTempContentIfNeeded()}),document.addEventListener("DOMContentLoaded",initializeEditor),document.addEventListener("DOMContentLoaded",()=>{loadTempContentIfNeeded()}),document.addEventListener("DOMContentLoaded",initializeEditor);